# ìˆ˜ì •ëœ apigateway-service-dev.yml

spring:
  cloud:
    config:
      enabled: false
    gateway:
      globalcors:
        cors-configurations:
          "[/**]":
            allowedOriginPatterns:
              - "http://localhost:5173"
              - "http://localhost:3000"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
              - HEAD
              - PATCH
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 3600

      default-filters:
        - name: DedupeResponseHeader
          args:
            name: Access-Control-Allow-Origin Access-Control-Allow-Credentials
            strategy: RETAIN_UNIQUE
        - name: LoggingFilter
          args:
            baseMessage: "API Gateway"
            preLogger: true
            postLogger: true

      routes:
        # ===========================================
        # ğŸ”¥ PRODUCT CATALOG SERVICE ë¼ìš°íŒ… (í†µí•© ì„œë¹„ìŠ¤)
        # ===========================================
        # [ê¸°ì¡´ ìƒí’ˆ ê´€ë ¨ ë¼ìš°íŒ… ìœ ì§€...]

        # ìƒí’ˆ í•„í„°ë§ ì¡°íšŒ - ê°€ì¥ ë¨¼ì €
        - id: product-filter-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/filter
            - Method=GET

        # ìƒí’ˆ í†µê³„ ì¡°íšŒ
        - id: product-stats-count-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/stats/count
            - Method=GET

        - id: product-stats-count-all-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/stats/count-all
            - Method=GET

        # ìƒí’ˆ ë””ë²„ê¹…
        - id: product-debug-status-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/debug/status
            - Method=GET

        # ì¶”ì²œ ìƒí’ˆ ì¡°íšŒ
        - id: product-recommended-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/recommended
            - Method=GET

        # ê²ŒìŠ¤íŠ¸ ì¥ë°”êµ¬ë‹ˆ ìƒì„¸ ì¡°íšŒ
        - id: product-guest-cart-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/guest-cart-details
            - Method=POST

        # í…ŒìŠ¤íŠ¸ API
        - id: product-test-simple-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/test-simple
            - Method=POST

        # í˜¸ìŠ¤íŠ¸ë³„ ìƒí’ˆ ì¡°íšŒ
        - id: product-host-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/host/{hostId}
            - Method=GET

        # ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ì¡°íšŒ (ì´ë¯¸ì§€ í¬í•¨)
        - id: product-category-with-images-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/category/{categoryId}/with-images
            - Method=GET

        # ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ì¡°íšŒ
        - id: product-category-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/category/{categoryId}
            - Method=GET

        # ì—°ê´€ ìƒí’ˆ ì¡°íšŒ (ì´ë¯¸ì§€ í¬í•¨)
        - id: product-related-with-images-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/{productId}/related/with-images
            - Method=GET

        # ì—°ê´€ ìƒí’ˆ ì¡°íšŒ
        - id: product-related-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/{productId}/related
            - Method=GET

        # ì´ë¯¸ì§€ í¬í•¨ ìƒí’ˆ ìƒì„¸ ì¡°íšŒ
        - id: product-with-images-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/{productId}/with-images
            - Method=GET

        # ìƒí’ˆ ìƒì„¸ ì¡°íšŒ (ê°œë³„ ID)
        - id: product-detail-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/{productId}
            - Method=GET

        # ì „ì²´ ìƒí’ˆ ì¡°íšŒ (ë§ˆì§€ë§‰ì— ë°°ì¹˜)
        - id: product-list-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products
            - Method=GET

        # ìƒí’ˆ ê´€ë¦¬ API (ê´€ë¦¬ììš©)
        - id: product-management-protected
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/products/**
            - Method=POST,PUT,DELETE,PATCH
          filters:
            - name: JwtAuthorization

        # 2. ì¹´í…Œê³ ë¦¬ API ë¼ìš°íŒ…
        # ë©”ì¸ ì¹´í…Œê³ ë¦¬ ì¡°íšŒ
        - id: category-main-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/categories/main
            - Method=GET

        # ê³„ì¸µí˜• ì¹´í…Œê³ ë¦¬ ì¡°íšŒ
        - id: category-hierarchy-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/categories/hierarchy
            - Method=GET

        # íŠ¹ì • ì¹´í…Œê³ ë¦¬ í•˜ìœ„ ì¡°íšŒ
        - id: category-sub-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/categories/{categoryId}/sub
            - Method=GET

        # ì¹´í…Œê³ ë¦¬ í•˜ìœ„ ID ì¡°íšŒ
        - id: category-children-ids-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/categories/{categoryId}/children-ids
            - Method=GET

        # ì¹´í…Œê³ ë¦¬ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        - id: category-exists-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/categories/{categoryId}/exists
            - Method=GET

        # íŠ¹ì • ì¹´í…Œê³ ë¦¬ ìƒì„¸ ì¡°íšŒ
        - id: category-detail-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/categories/{categoryId}
            - Method=GET

        # ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ API (ê´€ë¦¬ììš©)
        - id: category-management-protected
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/categories/**
            - Method=POST,PUT,DELETE,PATCH
          filters:
            - name: JwtAuthorization

        # 3. ì´ë¯¸ì§€ API ë¼ìš°íŒ…
        # ì •ì  ì´ë¯¸ì§€ íŒŒì¼ ì„œë¹™
        - id: image-static-files
          uri: lb://product-catalog-service
          predicates:
            - Path=/images/**
            - Method=GET

        # ìƒí’ˆ ì´ë¯¸ì§€ ì„œë¹™
        - id: image-products-files
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/products/{fileName}
            - Method=GET

        # ë ˆê±°ì‹œ ì´ë¯¸ì§€ ê²½ë¡œ
        - id: image-legacy-files
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/../../images/{fileName}
            - Method=GET

        # ì¸ë„¤ì¼ ì´ë¯¸ì§€
        - id: image-thumbnail-files
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/products/{fileName}/thumb
            - Method=GET

        # ìƒí’ˆë³„ ì´ë¯¸ì§€ ì¡°íšŒ API
        - id: image-product-images-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/products/{productId}
            - Method=GET

        # ë©”ì¸ ì´ë¯¸ì§€ ì¡°íšŒ
        - id: image-main-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/products/{productId}/main
            - Method=GET

        # ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        - id: image-exists-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/products/{productId}/exists
            - Method=GET

        # ë©”ì¸ ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        - id: image-main-exists-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/products/{productId}/main/exists
            - Method=GET

        # ë³µìˆ˜ ìƒí’ˆ ë©”ì¸ ì´ë¯¸ì§€ ì¡°íšŒ
        - id: image-main-bulk-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/products/main
            - Method=POST

        # ë³µìˆ˜ ìƒí’ˆ ì „ì²´ ì´ë¯¸ì§€ ì¡°íšŒ
        - id: image-all-bulk-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/products/all
            - Method=POST

        # ê°œë³„ ì´ë¯¸ì§€ ì¡°íšŒ (IDë³„)
        - id: image-by-id-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/{productId}
            - Method=GET

        # ê°œë³„ ë©”ì¸ ì´ë¯¸ì§€ ì¡°íšŒ (IDë³„)
        - id: image-main-by-id-public
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/{productId}/main
            - Method=GET

        # ì´ë¯¸ì§€ ê´€ë¦¬ API (ê´€ë¦¬ììš©)
        - id: image-upload-protected
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images
            - Method=POST
          filters:
            - name: JwtAuthorization

        - id: image-delete-protected
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/images/{imageId}
            - Method=DELETE
          filters:
            - name: JwtAuthorization

        # 4. ìºì‹œ ê´€ë¦¬ API (ê´€ë¦¬ììš©)
        - id: cache-management-protected
          uri: lb://product-catalog-service
          predicates:
            - Path=/api/cache/**
          filters:
            - name: JwtAuthorization

        # ===========================================
        # ğŸ”¥ USER SERVICE ë¼ìš°íŒ… (Board + QnA í†µí•©)
        # ===========================================

        # Q&A SERVICE ë¼ìš°íŒ… - user-serviceë¡œ ë³€ê²½
        - id: qna-health-check
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/qna/health
            - Method=GET

        - id: qna-product-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/qna/product/**
            - Method=GET

        - id: qna-list-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/qna/list
            - Method=GET

        - id: qna-debug-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/qna/debug/**
            - Method=GET

        - id: qna-test-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/qna/test
            - Method=GET

        - id: qna-my-protected
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/qna/my
            - Method=GET
          filters:
            - name: JwtAuthorization

        - id: qna-detail-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/qna/**
            - Method=GET

        - id: qna-service-protected
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/qna,/api/qna/**
            - Method=POST,PUT,DELETE,PATCH
          filters:
            - name: JwtAuthorization

        # BOARD SERVICE ë¼ìš°íŒ… - user-serviceë¡œ ë³€ê²½
        - id: board-health-check
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/board/health
            - Method=GET

        - id: board-product-reviews-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/board/product/**
            - Method=GET

        - id: board-list-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/board/list
            - Method=GET

        - id: board-debug-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/board/debug/**
            - Method=GET

        - id: board-test-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/board/test
            - Method=GET

        - id: board-reviews-public
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/board/reviews/**
            - Method=GET

        - id: board-service-protected
          uri: lb://user-service # âœ… user-serviceë¡œ ë³€ê²½
          predicates:
            - Path=/api/board/**
            - Method=POST,PUT,DELETE,PATCH
          filters:
            - name: JwtAuthorization

        # USER SERVICE ê¸°ì¡´ ë¼ìš°íŒ…
        - id: user-findId-public
          uri: lb://user-service
          predicates:
            - Path=/api/users/findId
            - Method=GET

        - id: user-register-public
          uri: lb://user-service
          predicates:
            - Path=/api/users/register
            - Method=POST

        - id: user-checkid-public
          uri: lb://user-service
          predicates:
            - Path=/api/users/checkUserId
            - Method=GET

        - id: user-profile-protected
          uri: lb://user-service
          predicates:
            - Path=/api/users/profile
            - Method=GET,PUT
          filters:
            - name: JwtAuthorization

        - id: user-detail-protected
          uri: lb://user-service
          predicates:
            - Path=/api/users/{userId}
            - Method=GET
          filters:
            - name: JwtAuthorization

        - id: user-verify-password-protected
          uri: lb://user-service
          predicates:
            - Path=/api/users/verify-password
            - Method=POST
          filters:
            - name: JwtAuthorization

        - id: user-email-protected
          uri: lb://user-service
          predicates:
            - Path=/api/users/{userId}/email
            - Method=GET
          filters:
            - name: JwtAuthorization

        - id: user-service-protected
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
            - Method=DELETE,PATCH,PUT
          filters:
            - name: JwtAuthorization

        # ===========================================
        # ğŸ”¥ ê¸°íƒ€ ì„œë¹„ìŠ¤ ë¼ìš°íŒ…
        # ===========================================

        # AUTH SERVICE ë¼ìš°íŒ…
        - id: auth-service-public
          uri: lb://auth-service
          predicates:
            - Path=/auth/**

        # ğŸ”¥ CART SERVICE ë¼ìš°íŒ… (order-serviceë¡œ í†µí•©ë¨)
        - id: cart-service-integrated
          uri: lb://order-service
          predicates:
            - Path=/api/cart/**
          filters:
            - name: JwtAuthorization

        # ğŸ”¥ ORDER SERVICE ë¼ìš°íŒ…
        - id: order-service-protected
          uri: lb://order-service
          predicates:
            - Path=/api/orders/**
          filters:
            - name: JwtAuthorization

        # ğŸ”¥ PAYMENT SERVICE ë¼ìš°íŒ… (order-serviceë¡œ í†µí•©ë¨)
        - id: payment-service-integrated
          uri: lb://order-service
          predicates:
            - Path=/api/payments/**

        # NOTIFICATION SERVICE ë¼ìš°íŒ…
        - id: notification-service-public
          uri: lb://notification-service
          predicates:
            - Path=/api/notifications/**

        # LIVE STREAMING SERVICE ë¼ìš°íŒ…
        - id: live-streaming-service
          uri: lb://live-streaming-service
          predicates:
            - Path=/api/streaming/**

        # LIVE CHAT SERVICE ë¼ìš°íŒ…
        - id: live-chat-service
          uri: lb://live-chat-service
          predicates:
            - Path=/api/chat/**

eureka:
  instance:
    hostname: localhost
    prefer-ip-address: true
    instance-id: ${spring.application.name}:${spring.application.instance_id:${server.port}}

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    org.springframework.cloud.gateway.handler.RoutePredicateHandlerMapping: DEBUG
    org.kosa.apigatewayservice: DEBUG

jwt:
  secret: verySecretKeyThatIsAtLeast32BytesLong1234
  expiration: 86400000
